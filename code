// This is the function that will handle HTTP GET requests when you deploy your script as a web app
function doGet() {
  return ContentService.createTextOutput(listAllGoogleTasks());
}

// This function lists tasks from all task lists in Google Tasks
function listAllGoogleTasks() {
  var taskLists = Tasks.Tasklists.list().items;
  
  if (!taskLists || taskLists.length === 0) {
    return "No task lists found.";
  }
  
  var output = "<table border='1'><tr><th>Task List Name</th><th>Task Name</th><th>Description</th></tr>";
  
  for (var i = 0; i < taskLists.length; i++) {
    var taskList = taskLists[i];
    var taskListName = taskList.title || "Unnamed Task List";
    var tasks = Tasks.Tasks.list(taskList.id).items;
    
    if (tasks && tasks.length > 0) {
      for (var j = 0; j < tasks.length; j++) {
        var task = tasks[j];
        var taskTitle = task.title || "No Title";
        var taskNotes = task.notes || "No Description";
        
        output += "<tr><td>" + taskListName + "</td><td>" + taskTitle + "</td><td>" + taskNotes + "</td></tr>";
      }
    } else {
      output += "<tr><td>" + taskListName + "</td><td colspan='2'>No tasks in this list</td></tr>";
    }
  }
  
  output += "</table>";
  return output;
}
