from google.cloud import resource_manager
from neo4j import GraphDatabase

def fetch_gcp_resources():
    client = resource_manager.Client()
    enabled_resources = []
    for project in client.list_projects():
        if project.status == "ACTIVE":
            enabled_resources.append(project.project_id)
    return enabled_resources

uri = "neo4j+s://<your-neo4j-uri>"
username = "<your-username>"
password = "<your-password>"

def upload_to_neo4j(enabled_resources):
    driver = GraphDatabase.driver(uri, auth=(username, password))
    with driver.session() as session:
        for resource in enabled_resources:
            session.run("MERGE (r:Resource {name: $name})", name=resource)

def main(request):
    enabled_resources = fetch_gcp_resources()
    upload_to_neo4j(enabled_resources)
    return "Data uploaded to Neo4j successfully"
